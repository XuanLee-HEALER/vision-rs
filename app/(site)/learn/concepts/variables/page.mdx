import LearnLayout from '@/components/LearnLayout';
import MermaidDiagram from '@/components/MermaidDiagram';

export const metadata = {
  title: 'å˜é‡ä¸å¸¸é‡ - Vision-RS',
  description: 'Rust ä¸­çš„å˜é‡ç»‘å®šã€å¯å˜æ€§ä¸å¸¸é‡',
};

<LearnLayout>

# å˜é‡ä¸å¸¸é‡

åœ¨ Rust ä¸­ï¼Œå˜é‡ç»‘å®šé»˜è®¤æ˜¯**ä¸å¯å˜çš„**ï¼ˆimmutableï¼‰ã€‚è¿™æ˜¯ Rust å®‰å…¨æ€§ä¿è¯çš„åŸºçŸ³ä¹‹ä¸€ã€‚

## å˜é‡ç»‘å®š

ä½¿ç”¨ `let` å…³é”®å­—åˆ›å»ºå˜é‡ç»‘å®šï¼š

```rust
fn main() {
    let x = 5;
    println!("x çš„å€¼æ˜¯: {}", x);
}
```

### ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯**ä¸å¯å˜çš„**ï¼š

```rust
fn main() {
    let x = 5;
    // x = 6;  // âŒ ç¼–è¯‘é”™è¯¯ï¼šcannot assign twice to immutable variable
    println!("x = {}", x);
}
```

#### ä¸ºä»€ä¹ˆé»˜è®¤ä¸å¯å˜ï¼Ÿ

- ğŸ”’ **å®‰å…¨æ€§**: é˜²æ­¢æ„å¤–ä¿®æ”¹
- ğŸš€ **å¹¶å‘**: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ›´å®‰å…¨
- ğŸ§  **å¯è¯»æ€§**: ä»£ç æ›´å®¹æ˜“ç†è§£
- âš¡ **ä¼˜åŒ–**: ç¼–è¯‘å™¨å¯ä»¥åšæ›´å¤šä¼˜åŒ–

## å¯å˜å˜é‡

ä½¿ç”¨ `mut` å…³é”®å­—å£°æ˜å¯å˜å˜é‡ï¼š

```rust
fn main() {
    let mut x = 5;
    println!("x çš„åˆå§‹å€¼: {}", x);

    x = 6;  // âœ… å¯ä»¥ä¿®æ”¹
    println!("x çš„æ–°å€¼: {}", x);
}
```

<MermaidDiagram
  chart={`
stateDiagram-v2
    [*] --> Immutable: let x = 5
    [*] --> Mutable: let mut x = 5

    Immutable --> [*]: åªèƒ½è¯»å–
    Mutable --> Modified: x = 6
    Modified --> [*]: å¯ä»¥ä¿®æ”¹

    note right of Immutable
        é»˜è®¤ä¸å¯å˜
        æ›´å®‰å…¨
    end note

    note right of Mutable
        æ˜¾å¼å£°æ˜å¯å˜
        éœ€è¦ mut å…³é”®å­—
    end note

`} />

## å˜é‡é®è”½ï¼ˆShadowingï¼‰

Rust å…è®¸ç”¨ç›¸åŒåç§°å£°æ˜æ–°å˜é‡ï¼Œ"é®è”½"æ—§å˜é‡ï¼š

```rust
fn main() {
    let x = 5;

    let x = x + 1;  // é®è”½ï¼šåˆ›å»ºæ–°å˜é‡

    {
        let x = x * 2;  // å†…å±‚ä½œç”¨åŸŸçš„é®è”½
        println!("å†…å±‚ x = {}", x);  // 12
    }

    println!("å¤–å±‚ x = {}", x);  // 6
}
```

### é®è”½ vs å¯å˜æ€§

**é®è”½çš„ä¼˜åŠ¿**ï¼š

1. **å¯ä»¥æ”¹å˜ç±»å‹**ï¼š

```rust
fn main() {
    let spaces = "   ";           // &str ç±»å‹
    let spaces = spaces.len();    // âœ… usize ç±»å‹ï¼Œé®è”½å…è®¸æ”¹å˜ç±»å‹

    // å¯¹æ¯”å¯å˜å˜é‡ï¼ˆä¸å…è®¸æ”¹å˜ç±»å‹ï¼‰ï¼š
    let mut count = "   ";
    // count = count.len();       // âŒ ç¼–è¯‘é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
}
```

2. **ä¿æŒä¸å¯å˜æ€§**ï¼š

```rust
fn main() {
    let x = 5;
    let x = x + 1;  // æ–°çš„ x ä»ç„¶æ˜¯ä¸å¯å˜çš„
    // x = 10;      // âŒ ä¸èƒ½ä¿®æ”¹
}
```

<MermaidDiagram
  chart={`
graph TD
    A[let x = 5] --> B[ç¬¬ä¸€ä¸ª x<br/>å€¼: 5]
    B --> C[let x = x + 1]
    C --> D[ç¬¬äºŒä¸ª x<br/>å€¼: 6<br/>é®è”½ç¬¬ä¸€ä¸ª x]
    D --> E[ä½œç”¨åŸŸç»“æŸ]
    E --> F[ç¬¬äºŒä¸ª x è¢«é”€æ¯]

    style B fill:#8aadf4,stroke:#8aadf4,color:#24273a
    style D fill:#a6da95,stroke:#a6da95,color:#24273a

`} />

## å¸¸é‡ï¼ˆConstantsï¼‰

å¸¸é‡ä½¿ç”¨ `const` å…³é”®å­—å£°æ˜ï¼Œå¹¶ä¸”**å¿…é¡»**æ ‡æ³¨ç±»å‹ï¼š

```rust
const MAX_POINTS: u32 = 100_000;
const PI: f64 = 3.14159;

fn main() {
    println!("æœ€å¤§ç‚¹æ•°: {}", MAX_POINTS);
}
```

### å¸¸é‡çš„ç‰¹ç‚¹

| ç‰¹æ€§     | å¸¸é‡                   | ä¸å¯å˜å˜é‡       |
| -------- | ---------------------- | ---------------- |
| å…³é”®å­—   | `const`                | `let`            |
| ç±»å‹æ ‡æ³¨ | **å¿…é¡»**               | å¯é€‰ï¼ˆç±»å‹æ¨å¯¼ï¼‰ |
| ä½œç”¨åŸŸ   | å¯ä»¥æ˜¯**å…¨å±€**         | é€šå¸¸æ˜¯å±€éƒ¨       |
| å€¼       | **ç¼–è¯‘æ—¶ç¡®å®š**         | è¿è¡Œæ—¶ç¡®å®š       |
| è¡¨è¾¾å¼   | åªèƒ½æ˜¯**å¸¸é‡è¡¨è¾¾å¼**   | ä»»æ„è¡¨è¾¾å¼       |
| å‘½åè§„èŒƒ | `SCREAMING_SNAKE_CASE` | `snake_case`     |

### å¸¸é‡ vs å˜é‡

```rust
// âœ… å¸¸é‡ï¼šç¼–è¯‘æ—¶æ±‚å€¼
const SECONDS_IN_HOUR: u32 = 60 * 60;

fn main() {
    // âœ… ä¸å¯å˜å˜é‡ï¼šè¿è¡Œæ—¶æ±‚å€¼
    let runtime_value = get_value();

    // âŒ å¸¸é‡ä¸èƒ½ä½¿ç”¨è¿è¡Œæ—¶å‡½æ•°
    // const WRONG: u32 = get_value();
}

fn get_value() -> u32 {
    42
}
```

## ç±»å‹æ¨å¯¼

Rust æœ‰å¼ºå¤§çš„ç±»å‹æ¨å¯¼èƒ½åŠ›ï¼š

```rust
fn main() {
    let x = 5;           // æ¨å¯¼ä¸º i32
    let y = 2.0;         // æ¨å¯¼ä¸º f64
    let is_true = true;  // æ¨å¯¼ä¸º bool

    // æ˜¾å¼ç±»å‹æ ‡æ³¨
    let z: u64 = 100;

    // é€šè¿‡ä½¿ç”¨æ–¹å¼æ¨å¯¼
    let mut guess = String::new();
    guess.push_str("42");
    let guess: i32 = guess.trim().parse().expect("Not a number!");
}
```

## æ•°å­—åˆ†éš”ç¬¦

ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œå¯ä»¥åœ¨æ•°å­—ä¸­ä½¿ç”¨ä¸‹åˆ’çº¿ï¼š

```rust
fn main() {
    let million = 1_000_000;
    let hex = 0xff_ff_ff;
    let binary = 0b1111_0000;
    let float = 1_234.567_890;

    println!("ä¸€ç™¾ä¸‡: {}", million);
}
```

## å®è·µå»ºè®®

### âœ… æ¨èåšæ³•

```rust
fn main() {
    // 1. é»˜è®¤ä½¿ç”¨ä¸å¯å˜å˜é‡
    let price = 100;

    // 2. åªåœ¨éœ€è¦æ—¶ä½¿ç”¨ mut
    let mut count = 0;
    count += 1;

    // 3. å¸¸é‡ç”¨äºé­”æ³•æ•°å­—
    const TAX_RATE: f64 = 0.08;
    let total = price as f64 * (1.0 + TAX_RATE);

    // 4. ä½¿ç”¨é®è”½æ”¹å˜ç±»å‹
    let input = "42";
    let input: i32 = input.parse().unwrap();
}
```

### âŒ é¿å…åšæ³•

```rust
fn main() {
    // âŒ ä¸å¿…è¦çš„ mut
    let mut x = 5;  // å¦‚æœåç»­ä¸ä¿®æ”¹ï¼Œä¸è¦ç”¨ mut
    println!("{}", x);

    // âŒ é­”æ³•æ•°å­—ï¼ˆåº”è¯¥ç”¨å¸¸é‡ï¼‰
    let tax = price * 0.08;  // 0.08 æ˜¯ä»€ä¹ˆï¼Ÿ

    // âŒ è¿‡åº¦ä½¿ç”¨é®è”½ï¼ˆå¯è¯»æ€§å·®ï¼‰
    let x = 1;
    let x = x + 1;
    let x = x * 2;
    let x = x - 1;
    // å¤ªå¤šé®è”½ä¼šè®©ä»£ç éš¾ä»¥è¿½è¸ª
}
```

## å†…å­˜è§†è§’

å˜é‡ç»‘å®šåœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºï¼š

```rust
fn main() {
    let x: i32 = 42;
    let y: i32 = x;  // Copy trait: æ ˆä¸Šå¤åˆ¶

    println!("x = {}, y = {}", x, y);
}
```

**æ ˆä¸Šçš„å¸ƒå±€**ï¼š

```
æ ˆå†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  x: 42   â”‚  â† i32 åœ¨æ ˆä¸Šï¼Œ4 å­—èŠ‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  y: 42   â”‚  â† å¤åˆ¶å€¼ï¼Œä¸æ˜¯å¼•ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»ƒä¹ é¢˜

### ç»ƒä¹  1ï¼šä¿®å¤ç¼–è¯‘é”™è¯¯

```rust
fn main() {
    let x = 5;
    x = 6;  // âŒ ç¼–è¯‘é”™è¯¯
    println!("{}", x);
}
```

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>

```rust
fn main() {
    let mut x = 5;  // æ·»åŠ  mut å…³é”®å­—
    x = 6;
    println!("{}", x);
}
```

</details>

### ç»ƒä¹  2ï¼šä½¿ç”¨é®è”½

å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œä½¿ç”¨é®è”½æŠ€æœ¯ï¼š

```rust
fn main() {
    let guess = "42";
    // åœ¨è¿™é‡Œå°† guess è½¬æ¢ä¸ºæ•°å­—ï¼ˆæç¤ºï¼šä½¿ç”¨é®è”½ï¼‰
}
```

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>

```rust
fn main() {
    let guess = "42";
    let guess: i32 = guess.parse().expect("Not a number!");
    println!("æ•°å­—æ˜¯: {}", guess);
}
```

</details>

## å°ç»“

- âœ… Rust ä¸­çš„å˜é‡é»˜è®¤**ä¸å¯å˜**
- âœ… ä½¿ç”¨ `mut` å…³é”®å­—å£°æ˜**å¯å˜å˜é‡**
- âœ… **é®è”½**å…è®¸é‡æ–°ç»‘å®šå˜é‡ï¼Œå¯ä»¥æ”¹å˜ç±»å‹
- âœ… **å¸¸é‡**ç”¨ `const` å£°æ˜ï¼Œå¿…é¡»æ ‡æ³¨ç±»å‹ï¼Œç¼–è¯‘æ—¶æ±‚å€¼
- âœ… ä¸å¯å˜æ€§å¸¦æ¥**å®‰å…¨æ€§**ã€**å¹¶å‘æ€§**å’Œ**ä¼˜åŒ–**ä¼˜åŠ¿
- âœ… ä¼˜å…ˆä½¿ç”¨ä¸å¯å˜ï¼Œåªåœ¨å¿…è¦æ—¶ä½¿ç”¨å¯å˜

ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å­¦ä¹  Rust çš„**æ•°æ®ç±»å‹ç³»ç»Ÿ**ã€‚

</LearnLayout>
